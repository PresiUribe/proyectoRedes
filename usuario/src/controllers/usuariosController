const { Router } = require('express');
const router = Router();
const usuariosModel = require('../models/usuariosModel');

// Obtener la información de un usuario por ID
router.get('/usuarios/:id', async (req, res) => {
    const id = req.params.id;
    const result = await usuariosModel.traerUsuario(id);
    res.json(result[0]);
});

// Validar credenciales de usuario (login)
// Se espera recibir "usuario" y "password" vía query params, por ejemplo:
// /usuarios/login?usuario=xxx&password=yyy
router.get('/usuarios/login', async (req, res) => {
    const { usuario, password } = req.query;
    const result = await usuariosModel.validarCredenciales(usuario, password);
    if (result && result.length > 0) {
        res.json(result[0]);
    } else {
        res.status(401).send("Credenciales inválidas");
    }
});

// Actualizar un usuario existente
// Se actualizan todos los campos: nombre, email, usuario, password, tipo, tipo_tarjeta, numero_tarjeta, cvc y fecha_expiracion
router.put('/usuarios/:id', async (req, res) => {
    const id = req.params.id;
    const { nombre, email, usuario, password, tipo, tipo_tarjeta, numero_tarjeta, cvc, fecha_expiracion } = req.body;
    await usuariosModel.actualizarUsuario(id, { nombre, email, usuario, password, tipo, tipo_tarjeta, numero_tarjeta, cvc, fecha_expiracion });
    res.send("Usuario actualizado");
});

// Crear un nuevo usuario
// Se espera recibir: nombre, email, usuario, password, tipo, tipo_tarjeta, numero_tarjeta, cvc y fecha_expiracion en el body
router.post('/usuarios', async (req, res) => {
    const { nombre, email, usuario, password, tipo, tipo_tarjeta, numero_tarjeta, cvc, fecha_expiracion } = req.body;
    await usuariosModel.crearUsuario(nombre, email, usuario, password, tipo, tipo_tarjeta, numero_tarjeta, cvc, fecha_expiracion);
    res.send("Usuario creado");
});

// Eliminar un usuario por ID
router.delete('/usuarios/:id', async (req, res) => {
    const id = req.params.id;
    await usuariosModel.borrarUsuario(id);
    res.send("Usuario borrado");
});

module.exports = router;
